{
    "collab_server" : "",
    "contents" : "---\ntitle: \"KI Reef Fish Data - Statistical Analysis\"\nauthor: \"Jennifer Magel\"\ndate: \"`r format(Sys.time(), '%B %d, %Y')`\"\noutput: \n  html_document:\n    toc: true\n    toc_float: true\n    toc_depth: 2\n---\n\n```{r setup, include = FALSE}\n# Load the data (abundance summed to site level, observers remain separate)\nload(\"../Data/KI_UVC_13_15_17_obs_sum.Rdata\")\nload(\"../Data/KI_UVC_13_15_17_BM_obs_sum_ALL.Rdata\")\nwaves_prod <- read.csv(\"../Data/KI_wave_prod_data_SESYNC.csv\", stringsAsFactors = FALSE)\n\n# Load necessary packages\nlibrary(ggplot2)\nlibrary(glmmADMB)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(dplyr)\nlibrary(lme4)\nlibrary(arm)\n\n# Set seed for random processes\nset.seed(9)\n\n# Order fishing pressure levels\nki_fish$f.pressure <- factor(ki_fish$f.pressure, levels(factor(ki_fish$f.pressure))[c(5,2,3,1,4)])\nki_fish_BM$f.pressure <- factor(ki_fish_BM$f.pressure, levels(factor(ki_fish_BM$f.pressure))[c(5,2,3,1,4)])\n\n## Subset the data\nsites_13 <- unique(ki_fish$Site[ki_fish$Year == \"2013\"])\nsites_15 <- unique(ki_fish$Site[ki_fish$Year == \"2015\"])\nsites_17 <- unique(ki_fish$Site[ki_fish$Year == \"2017\"])\n\nsites_BDA <- Reduce(intersect, list(sites_13, sites_15, sites_17))\n\nki_fish <- filter(ki_fish, Site %in% sites_BDA)\nki_fish <- ki_fish[!(ki_fish$Site == \"1\"), ]\nki_fish <- ki_fish[!(ki_fish$Site == \"3\"), ]\nki_fish <- ki_fish[!(ki_fish$Site == \"6\"), ]\nki_fish <- ki_fish[!(ki_fish$Site == \"25\"), ]\n\nki_fish_BM <- filter(ki_fish_BM, Site %in% sites_BDA)\nki_fish_BM <- ki_fish_BM[!(ki_fish_BM$Site == \"1\"), ]\nki_fish_BM <- ki_fish_BM[!(ki_fish_BM$Site == \"3\"), ]\nki_fish_BM <- ki_fish_BM[!(ki_fish_BM$Site == \"6\"), ]\nki_fish_BM <- ki_fish_BM[!(ki_fish_BM$Site == \"25\"), ]\n\n## Add SESYNC productivity data\nki_fish$npp_mean <- waves_prod$npp_mean[match(ki_fish$Site, waves_prod$Site)]\nki_fish$npp_max <- waves_prod$npp_max[match(ki_fish$Site, waves_prod$Site)]\n\nki_fish_BM$npp_mean <- waves_prod$npp_mean[match(ki_fish_BM$Site, waves_prod$Site)]\nki_fish_BM$npp_max <- waves_prod$npp_max[match(ki_fish_BM$Site, waves_prod$Site)]\n\n# Rescale productivity variable\nki_fish$npp_max_z <- rescale(ki_fish$npp_max)\nki_fish_BM$npp_max_z <- rescale(ki_fish_BM$npp_max)\n```\n\nFitting generalized linear mixed-effects models to model reef fish abundance, biomass, and species richness. Year and fishing pressure are included as fixed effects (plus an **interaction**) as well as productivity (npp_max), while Site and **Observer nested within Year** are included as random effects. Site 3 has been removed from the analysis, as this is the only site in the 'Low' disturbance category. Sites 1, 6, and 25 have also been removed, to trim the analysis down to three human disturbance levels (and avoid having 7 'medium' sites).\n\n\n# Zeroes\n\nCalculating the number of non-zero observations for each trophic group. Proportion of zeroes for groups with at least one zero observation: Corallivores = 9.8%, Detritivores = 8.0%, Generalist carnivores/Piscivores = 0.9%.\n\n```{r zeroes, echo = FALSE}\nzeroes <- as.data.frame(colSums(ki_fish[, c(7, 9:17)] != 0))\nzeroes\n```\n\n\n# Total Abundance\n\n```{r AB_total, echo = FALSE}\nmodel1 <- glmmadmb(AB_total ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model1), resid(model1))\nsummary(model1)\n```\n\n## Means\n\n```{r AB_total_mean, echo = FALSE}\nab <- aggregate(AB_total ~ Year, ki_fish, mean)\nab.sd <- aggregate(AB_total ~ Year, ki_fish, function(x) sd(x))\nab.se <- aggregate(AB_total ~ Year, ki_fish, function(x) sd(x)/sqrt(length(x)))\nab$SD <- ab.sd$AB_total\nab$SE <- ab.se$AB_total\nab\n```\n\n\n# Trophic Group Abundance\n## Corallivores\n\n```{r AB_coral, echo = FALSE}\nmodel2 <- glmmadmb(AB_coral ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model2), resid(model2))\nsummary(model2)\n```\n\n\n## Detritivores\n\n```{r AB_det, echo = FALSE}\nmodel3 <- glmmadmb(AB_det ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, zeroInflation = TRUE, family = \"nbinom\")\nplot(fitted(model3), resid(model3))\nsummary(model3)\n```\n\n\n## Generalist Carnivores\n\n```{r AB_gen, echo = FALSE}\nmodel4 <- glmmadmb(AB_gen ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model4), resid(model4))\nsummary(model4)\n```\n\n\n## Herbivores\n\n```{r AB_herb, echo = FALSE}\nmodel5 <- glmmadmb(AB_herb ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model5), resid(model5))\nsummary(model5)\n```\n\n\n## Invertivores\n\n```{r AB_inv, echo = FALSE}\nmodel6 <- glmmadmb(AB_inv ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model6), resid(model6))\nsummary(model6)\n```\n\n\n## Omnivores\n\n```{r AB_omn, echo = FALSE}\nmodel7 <- glmmadmb(AB_omn ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model7), resid(model7))\nsummary(model7)\n```\n\n\n## Piscivores\n\n```{r AB_pisc, echo = FALSE}\nmodel8 <- glmmadmb(AB_pisc ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model8), resid(model8))\nsummary(model8)\n```\n\n\n## Planktivores\n\n```{r AB_plank, echo = FALSE}\nmodel9 <- glmmadmb(AB_plank ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = \"nbinom\")\nplot(fitted(model9), resid(model9))\nsummary(model9)\n```\n\n\n# Biomass\n\n```{r BM_total, echo = FALSE}\nmodel10 <- glmer(BM_total ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish_BM, family = Gamma(link = \"log\"), \n                control = glmerControl(optimizer = \"bobyqa\"))\n\nplot(fitted(model10), resid(model10))\nsummary(model10)\n```\n\n## Means\n\n```{r BM_total_mean, echo = FALSE}\nbm <- aggregate(BM_total ~ Year, ki_fish_BM, mean)\nbm.sd <- aggregate(BM_total ~ Year, ki_fish_BM, function(x) sd(x))\nbm.se <- aggregate(BM_total ~ Year, ki_fish_BM, function(x) sd(x)/sqrt(length(x)))\nbm$SD <- bm.sd$BM_total\nbm$SE <- bm.se$BM_total\nbm\n```\n\n# Species Richness\n\n```{r SR_total, echo = FALSE}\nmodel11 <- glmer(SR_total ~ Year * f.pressure + npp_max_z + (1|Site) + (1|Year/Observer), data = ki_fish, family = poisson(link = \"log\"))\nplot(fitted(model11), resid(model11))\nsummary(model11)\n```\n\n## Means\n\n```{r SR_total_mean, echo = FALSE}\nsr <- aggregate(SR_total ~ Year, ki_fish, mean)\nsr.sd <- aggregate(SR_total ~ Year, ki_fish, function(x) sd(x))\nsr.se <- aggregate(SR_total ~ Year, ki_fish, function(x) sd(x)/sqrt(length(x)))\nsr$SD <- sr.sd$SR_total\nsr$SE <- sr.se$SR_total\nsr\n```\n\n",
    "created" : 1545250223919.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1055534793",
    "id" : "BAB60FDE",
    "lastKnownWriteTime" : 1544556620,
    "last_content_update" : 1544556620,
    "path" : "~/GitHub/ki-fish/Sean_Acoustics/R_Scripts/KI_fish_models_final_JM.Rmd",
    "project_path" : "R_Scripts/KI_fish_models_final_JM.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}